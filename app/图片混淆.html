---
permalink: app/tphx
---
<style>
    :root {
        --primary-color: #4a6fa5;
        --secondary-color: #6d8ca6;
        --light-color: #e8eef2;
        --dark-color: #2c3e50;
        --success-color: #27ae60;
        --danger-color: #e74c3c;
    }
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
        background-color: #f5f7fa;
        color: var(--dark-color);
        line-height: 1.6;
    }
    
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    
    header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px 0;
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    h1 {
        color: var(--primary-color);
        margin-bottom: 10px;
        font-weight: 600;
    }
    
    .intro {
        color: #666;
        max-width: 800px;
        margin: 0 auto;
    }
    
    .main-content {
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
        justify-content: center;
    }
    
    .image-section {
        flex: 1;
        min-width: 300px;
        max-width: 500px;
        background-color: white;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    .section-title {
        font-size: 1.2rem;
        color: var(--primary-color);
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--light-color);
    }
    
    .upload-area {
        border: 2px dashed var(--secondary-color);
        border-radius: 8px;
        padding: 40px 20px;
        text-align: center;
        margin-bottom: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .upload-area:hover {
        background-color: rgba(109, 140, 166, 0.05);
        border-color: var(--primary-color);
    }
    
    .upload-icon {
        font-size: 2.5rem;
        color: var(--secondary-color);
        margin-bottom: 15px;
    }
    
    .upload-text {
        color: #666;
        margin-bottom: 10px;
    }
    
    #file-input {
        display: none;
    }
    
    .image-container {
        width: 100%;
        height: 300px;
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
        background-color: #f9f9f9;
        position: relative;
        margin-bottom: 20px;
    }
    
    .image-placeholder {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #999;
    }
    
    .image-placeholder-icon {
        font-size: 3rem;
        margin-bottom: 10px;
    }
    
    #original-image, #processed-image {
        max-width: 100%;
        max-height: 100%;
        display: none;
    }
    
    .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
    }
    
    button {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        background-color: var(--primary-color);
        color: white;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    button:hover {
        background-color: #3a5d8c;
        transform: translateY(-2px);
    }
    
    button:active {
        transform: translateY(0);
    }
    
    button.secondary {
        background-color: var(--secondary-color);
    }
    
    button.secondary:hover {
        background-color: #5d7b96;
    }
    
    button.danger {
        background-color: var(--danger-color);
    }
    
    button.danger:hover {
        background-color: #c0392b;
    }
    
    button.success {
        background-color: var(--success-color);
    }
    
    button.success:hover {
        background-color: #219653;
    }
    
    .settings {
        background-color: var(--light-color);
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .setting-item {
        margin-bottom: 15px;
    }
    
    .setting-item label {
        display: block;
        margin-bottom: 5px;
        color: var(--dark-color);
        font-weight: 500;
    }
    
    .setting-item input[type="number"] {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
    }
    
    .setting-item input[type="text"] {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
    }
    
    .setting-item input[type="checkbox"] {
        width: auto;
        margin-right: 8px;
    }
    
    .grid-settings {
        display: flex;
        gap: 10px;
    }
    
    .grid-settings .setting-item {
        flex: 1;
    }
    
    .status-message {
        margin-top: 20px;
        padding: 10px 15px;
        border-radius: 6px;
        display: none;
    }
    
    .status-success {
        background-color: rgba(39, 174, 96, 0.1);
        color: var(--success-color);
        display: block;
    }
    
    .status-error {
        background-color: rgba(231, 76, 60, 0.1);
        color: var(--danger-color);
        display: block;
    }
    
    footer {
        text-align: center;
        margin-top: 50px;
        padding: 20px;
        color: #777;
        font-size: 0.9rem;
    }
    
    /* å›¾æ ‡æ¨¡æ‹Ÿç±» */
    .icon {
        display: inline-block;
        width: 24px;
        height: 24px;
        position: relative;
    }
    
    .icon-upload::before {
        content: "â†‘";
        font-size: 24px;
    }
    
    .icon-image::before {
        content: "ğŸ–¼ï¸";
        font-size: 24px;
    }
    
    .icon-scramble::before {
        content: "ğŸ”€";
        font-size: 24px;
    }
    
    .icon-restore::before {
        content: "ğŸ”„";
        font-size: 24px;
    }
    
    .icon-save::before {
        content: "ğŸ’¾";
        font-size: 24px;
    }
    
    .icon-invert::before {
        content: "ğŸ¨";
        font-size: 24px;
    }
    
    .icon-seed::before {
        content: "ğŸ”‘";
        font-size: 24px;
    }
    
    @media (max-width: 768px) {
        .main-content {
            flex-direction: column;
        }
        
        .image-section {
            max-width: 100%;
        }
        
        .controls {
            flex-direction: column;
        }
        
        button {
            width: 100%;
            justify-content: center;
        }
        
        .grid-settings {
            flex-direction: column;
            gap: 15px;
        }
    }
</style>

    <div class="container">
        <header>
            <h1>å›¾ç‰‡æ··æ·†</h1>
            <p class="intro">
                1. å›¾ç‰‡å¤„ç†å‡åœ¨æœ¬åœ°è¿›è¡Œï¼Œä¸ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚<br>
                2. ç½‘æ ¼æ•°å†³å®šäº†æ··æ·†å›¾ç‰‡çš„åˆ‡å‰²æ•°é‡ï¼Œæ•°é‡è¶Šå¤§æ··æ·†æ•ˆæœè¶Šå¥½ï¼Œä½†ä¹Ÿè¶Šå®¹æ˜“å¡é¡¿ã€‚<br>
                3. è¯·è®°ä½è®¾ç½®çš„ç½‘æ ¼æ•°å’Œéšæœºç§å­ï¼Œåœ¨è¿˜åŸæ—¶éœ€è¦ä¿æŒä¸€è‡´ã€‚
            </p>
        </header>
        
        <div class="main-content">
            <div class="image-section">
                <h2 class="section-title">ä¸Šä¼ å›¾ç‰‡</h2>
                <div class="upload-area" id="upload-area">
                    <div class="upload-icon icon icon-upload"></div>
                    <p class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„ä¸Šä¼ </p>
                    <p class="upload-text">æ”¯æŒ JPGã€PNG æ ¼å¼</p>
                    <input type="file" id="file-input" accept="image/*">
                </div>
                
                <div class="image-container">
                    <div class="image-placeholder" id="original-placeholder">
                        <div class="image-placeholder-icon icon icon-image"></div>
                        <p></p>
                    </div>
                    <img id="original-image" alt="åŸå§‹å›¾ç‰‡">
                </div>
                
                <div class="settings">
                    <div class="grid-settings">
                        <div class="setting-item">
                            <label for="grid-rows">ç½‘æ ¼è¡Œæ•° (1-1000)</label>
                            <input type="number" id="grid-rows" value="50" min="1" max="1000">
                        </div>
                        <div class="setting-item">
                            <label for="grid-cols">ç½‘æ ¼åˆ—æ•° (1-1000)</label>
                            <input type="number" id="grid-cols" value="50" min="1" max="1000">
                        </div>
                    </div>
                    <div class="setting-item">
                        <label for="random-seed">éšæœºç§å­ (ä»»æ„å­—ç¬¦)</label>
                        <input type="text" id="random-seed" value="12345" placeholder="è¾“å…¥ä»»æ„å­—ç¬¦ä½œä¸ºç§å­">
                    </div>
                    <div class="setting-item" style="display:none;">
                        <label>
                            <input type="checkbox" id="enable-invert" checked>
                            æ··æ·†æ—¶æ·»åŠ åè‰²æ•ˆæœ
                        </label>
                    </div>
                    <div class="setting-item" style="display:none;">
                        <label for="invert-percentage">åè‰²åŒºå—æ¯”ä¾‹ (%)</label>
                        <input type="number" id="invert-percentage" value="50" min="0" max="100">
                    </div>
                </div>
                
                <div class="controls">
                    <button id="scramble-btn">
                        <span class="icon icon-scramble"></span>
                        æ··æ·†å›¾ç‰‡
                    </button>
                    <button id="restore-btn" class="secondary">
                        <span class="icon icon-restore"></span>
                        è¿˜åŸå›¾ç‰‡
                    </button>
                </div>
                
                <div class="status-message" id="status-original"></div>
            </div>
            
            <div class="image-section">
                <h2 class="section-title">å¤„ç†åçš„å›¾ç‰‡</h2>
                
                <div class="image-container">
                    <div class="image-placeholder" id="processed-placeholder">
                        <div class="image-placeholder-icon icon icon-image"></div>
                        <p></p>
                    </div>
                    <img id="processed-image" alt="å¤„ç†åçš„å›¾ç‰‡">
                </div>
                
                <div class="controls">
                    <button id="save-btn" class="success" disabled>
                        <span class="icon icon-save"></span>
                        ä¿å­˜å›¾ç‰‡
                    </button>
                    <button id="clear-btn" class="danger">
                        æ¸…é™¤å›¾ç‰‡
                    </button>
                </div>
                
                <div class="status-message" id="status-processed"></div>
            </div>
        </div>
    </div>

    <script>
        // DOM å…ƒç´ 
        const fileInput = document.getElementById('file-input');
        const uploadArea = document.getElementById('upload-area');
        const originalImage = document.getElementById('original-image');
        const processedImage = document.getElementById('processed-image');
        const originalPlaceholder = document.getElementById('original-placeholder');
        const processedPlaceholder = document.getElementById('processed-placeholder');
        const scrambleBtn = document.getElementById('scramble-btn');
        const restoreBtn = document.getElementById('restore-btn');
        const saveBtn = document.getElementById('save-btn');
        const clearBtn = document.getElementById('clear-btn');
        const gridRowsInput = document.getElementById('grid-rows');
        const gridColsInput = document.getElementById('grid-cols');
        const randomSeedInput = document.getElementById('random-seed');
        const enableInvert = document.getElementById('enable-invert');
        const invertPercentage = document.getElementById('invert-percentage');
        const statusOriginal = document.getElementById('status-original');
        const statusProcessed = document.getElementById('status-processed');
        
        // å­˜å‚¨å½“å‰ä½¿ç”¨çš„ç§å­å€¼
        let currentSeed = '12345';
        
        // åˆå§‹åŒ–
        function init() {
            // äº‹ä»¶ç›‘å¬
            uploadArea.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileUpload);
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('drop', handleDrop);
            
            scrambleBtn.addEventListener('click', scrambleImage);
            restoreBtn.addEventListener('click', restoreImage);
            saveBtn.addEventListener('click', saveProcessedImage);
            clearBtn.addEventListener('click', clearImages);
            gridRowsInput.addEventListener('change', validateGridSize);
            gridColsInput.addEventListener('change', validateGridSize);
            invertPercentage.addEventListener('change', validateInvertPercentage);
            randomSeedInput.addEventListener('change', updateSeed);
            
            // éªŒè¯åˆå§‹è®¾ç½®
            validateGridSize();
            validateInvertPercentage();
            updateSeed();
        }
        
        // æ›´æ–°ç§å­å€¼
        function updateSeed() {
            currentSeed = randomSeedInput.value.trim() || '12345'; // ç¡®ä¿ç§å­å€¼ä¸ä¸ºç©º
            showStatus(`éšæœºç§å­å·²è®¾ç½®ä¸º: ${currentSeed}`, 'success', statusOriginal);
        }
        
        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (file) {
                processFile(file);
            }
        }
        
        // å¤„ç†æ‹–æ”¾
        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.style.backgroundColor = 'rgba(109, 140, 166, 0.1)';
        }
        
        function handleDrop(e) {
            e.preventDefault();
            uploadArea.style.backgroundColor = '';
            
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                processFile(file);
            } else {
                showStatus('è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶', 'error', statusOriginal);
            }
        }
        
        // å¤„ç†æ–‡ä»¶å¹¶æ˜¾ç¤ºå›¾ç‰‡
        function processFile(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                originalImage.src = e.target.result;
                originalImage.onload = function() {
                    originalPlaceholder.style.display = 'none';
                    originalImage.style.display = 'block';
                    showStatus('å›¾ç‰‡å·²åŠ è½½', 'success', statusOriginal);
                    
                    // é‡ç½®å¤„ç†åçš„å›¾ç‰‡
                    processedImage.style.display = 'none';
                    processedPlaceholder.style.display = 'flex';
                    saveBtn.disabled = true;
                };
            };
            
            reader.onerror = function() {
                showStatus('å›¾ç‰‡åŠ è½½å¤±è´¥', 'error', statusOriginal);
            };
            
            reader.readAsDataURL(file);
        }
        
        // éªŒè¯ç½‘æ ¼å¤§å°è¾“å…¥
        function validateGridSize() {
            const rows = parseInt(gridRowsInput.value);
            const cols = parseInt(gridColsInput.value);
            
            if (isNaN(rows) || isNaN(cols) || rows < 1 || rows > 1000 || cols < 1 || cols > 1000) {
                showStatus('è¯·è¾“å…¥æœ‰æ•ˆçš„ç½‘æ ¼å¤§å° (1-1000)', 'error', statusOriginal);
                return false;
            }
            
            showStatus(`ç½‘æ ¼å¤§å°è®¾ç½®ä¸º ${rows}x${cols}`, 'success', statusOriginal);
            return { rows, cols };
        }
        
        // éªŒè¯åè‰²æ¯”ä¾‹
        function validateInvertPercentage() {
            const percent = parseInt(invertPercentage.value);
            if (isNaN(percent) || percent < 0 || percent > 100) {
                showStatus('è¯·è¾“å…¥æœ‰æ•ˆçš„åè‰²æ¯”ä¾‹ (0-100)', 'error', statusOriginal);
                invertPercentage.value = 50;
                return 50;
            }
            return percent;
        }
        
        // è®¡ç®—æ¯ä¸ªåŒºå—çš„ç²¾ç¡®ä½ç½®å’Œå¤§å°
        function calculateBlockDimensions(imageWidth, imageHeight, rows, cols) {
            const blocks = [];
            const totalWidth = imageWidth;
            const totalHeight = imageHeight;
            
            // è®¡ç®—æ¯åˆ—å®½åº¦
            const colWidths = new Array(cols).fill(0);
            const baseWidth = Math.floor(totalWidth / cols);
            const extraWidth = totalWidth % cols;
            for (let i = 0; i < cols; i++) {
                colWidths[i] = baseWidth + (i < extraWidth ? 1 : 0);
            }
            
            // è®¡ç®—æ¯è¡Œé«˜åº¦
            const rowHeights = new Array(rows).fill(0);
            const baseHeight = Math.floor(totalHeight / rows);
            const extraHeight = totalHeight % rows;
            for (let i = 0; i < rows; i++) {
                rowHeights[i] = baseHeight + (i < extraHeight ? 1 : 0);
            }
            
            // è®¡ç®—æ¯ä¸ªåŒºå—çš„ä½ç½®å’Œå¤§å°
            let currentY = 0;
            for (let y = 0; y < rows; y++) {
                let currentX = 0;
                const blockHeight = rowHeights[y];
                
                for (let x = 0; x < cols; x++) {
                    const blockWidth = colWidths[x];
                    
                    blocks.push({
                        x: currentX,
                        y: currentY,
                        width: blockWidth,
                        height: blockHeight,
                        gridX: x,
                        gridY: y
                    });
                    
                    currentX += blockWidth;
                }
                
                currentY += blockHeight;
            }
            
            return blocks;
        }
        
        // å¯¹å›¾åƒæ•°æ®è¿›è¡Œåè‰²å¤„ç†
        function invertColors(imageData) {
            const data = imageData.data;
            for (let i = 0; i < data.length; i += 4) {
                // åè‰²å¤„ç†ï¼š255å‡å»å½“å‰å€¼ï¼ˆä¸æ”¹å˜é€æ˜åº¦ï¼‰
                data[i] = 255 - data[i];     // çº¢è‰²
                data[i + 1] = 255 - data[i + 1]; // ç»¿è‰²
                data[i + 2] = 255 - data[i + 2]; // è“è‰²
                // ä¿æŒé€æ˜åº¦ä¸å˜ data[i + 3]
            }
            return imageData;
        }
        
        // åŸºäºç§å­çš„ä¼ªéšæœºæ•°ç”Ÿæˆå™¨
        function createSeedRandom(seed) {
            // å°†ç§å­å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—
            let hash = 0;
            for (let i = 0; i < seed.length; i++) {
                const char = seed.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // è½¬æ¢ä¸º32ä½æ•´æ•°
            }
            
            // çº¿æ€§åŒä½™ç”Ÿæˆå™¨
            return function() {
                hash = Math.sin(hash) * 10000;
                return hash - Math.floor(hash);
            };
        }
        
        // ä½¿ç”¨ç§å­è¿›è¡Œæ•°ç»„æ´—ç‰Œ
        function shuffleArrayWithSeed(array, seed) {
            const random = createSeedRandom(seed);
            const newArray = [...array];
            
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            
            return newArray;
        }
        
        // æ··æ·†å›¾ç‰‡ï¼ˆä½¿ç”¨ç§å­æ§åˆ¶éšæœºæ•ˆæœï¼‰
        function scrambleImage() {
            if (!originalImage.src) {
                showStatus('è¯·å…ˆä¸Šä¼ å›¾ç‰‡', 'error', statusOriginal);
                return;
            }
            
            const gridSize = validateGridSize();
            if (!gridSize) return;
            
            const { rows, cols } = gridSize;
            const totalBlocks = rows * cols;
            const invertPercent = validateInvertPercentage();
            const seed = currentSeed;
            
            // å¯¹äºéå¸¸å¤§çš„ç½‘æ ¼ç»™å‡ºè­¦å‘Š
            if (totalBlocks > 10000) {
                if (!confirm(`æ‚¨è®¾ç½®çš„ç½‘æ ¼è¾ƒå¤§ï¼ˆ${totalBlocks}ä¸ªåŒºå—ï¼‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´æµè§ˆå™¨å¡é¡¿ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ`)) {
                    return;
                }
            }
            
            // åˆ›å»ºcanvaså…ƒç´ è¿›è¡Œå¤„ç†
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // è®¾ç½®canvaså°ºå¯¸ä¸åŸå›¾å®Œå…¨ä¸€è‡´
            canvas.width = originalImage.naturalWidth;
            canvas.height = originalImage.naturalHeight;
            
            // ç»˜åˆ¶åŸå›¾åˆ°canvas
            ctx.drawImage(originalImage, 0, 0);
            
            // è®¡ç®—æ¯ä¸ªåŒºå—çš„ç²¾ç¡®ä½ç½®å’Œå¤§å°
            const blocks = calculateBlockDimensions(canvas.width, canvas.height, rows, cols);
            
            // æå–æ¯ä¸ªåŒºå—çš„åƒç´ æ•°æ®
            const blockData = blocks.map(block => {
                return {
                    ...block,
                    pixels: ctx.getImageData(block.x, block.y, block.width, block.height)
                };
            });
            
            // ä½¿ç”¨ç§å­ç”Ÿæˆå¯é‡ç°çš„éšæœºæ‰“ä¹±é¡ºåº
            const baseOrder = Array.from({ length: blocks.length }, (_, i) => i);
            const scrambleOrder = shuffleArrayWithSeed(baseOrder, `scramble_${seed}`);
            
            // ä½¿ç”¨ç§å­å†³å®šå“ªäº›åŒºå—éœ€è¦åè‰²å¤„ç†ï¼ˆç¡®ä¿å¯é‡ç°ï¼‰
            const invertMap = Array(blocks.length).fill(false);
            const invertCount = Math.floor(totalBlocks * (invertPercent / 100));
            
            // åŸºäºç§å­ç”Ÿæˆåè‰²åŒºå—æ˜ å°„
            if (enableInvert.checked && invertCount > 0) {
                const invertIndices = shuffleArrayWithSeed(baseOrder, `invert_${seed}`);
                for (let i = 0; i < invertCount; i++) {
                    invertMap[invertIndices[i]] = true;
                }
            }
            
            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // æŒ‰ç…§æ‰“ä¹±çš„é¡ºåºç»˜åˆ¶åŒºå—ï¼Œå¹¶å¯¹æŒ‡å®šåŒºå—è¿›è¡Œåè‰²
            for (let i = 0; i < blocks.length; i++) {
                const originalIndex = scrambleOrder[i];
                const targetBlock = blocks[i];
                let sourceData = blockData[originalIndex].pixels;
                
                // å¦‚æœéœ€è¦åè‰²ï¼Œå…ˆå¤åˆ¶æ•°æ®å†å¤„ç†
                if (invertMap[i]) {
                    // åˆ›å»ºæ•°æ®å‰¯æœ¬
                    const invertedData = new ImageData(
                        new Uint8ClampedArray(sourceData.data),
                        sourceData.width,
                        sourceData.height
                    );
                    sourceData = invertColors(invertedData);
                }
                
                // ç»˜åˆ¶åŒºå—åˆ°æ–°ä½ç½®
                ctx.putImageData(sourceData, targetBlock.x, targetBlock.y);
            }
            
            // æ˜¾ç¤ºå¤„ç†åçš„å›¾ç‰‡
            processedImage.src = canvas.toDataURL('image/png');
            processedImage.onload = function() {
                processedPlaceholder.style.display = 'none';
                processedImage.style.display = 'block';
                saveBtn.disabled = false;
                showStatus(`å›¾ç‰‡å·²æ··æ·†ï¼Œä½¿ç”¨ç§å­: ${seed}`, 'success', statusProcessed);
            };
        }
        
        // è¿˜åŸå›¾ç‰‡ï¼ˆä½¿ç”¨ç›¸åŒç§å­ç¡®ä¿å¯é‡ç°ï¼‰
        function restoreImage() {
            if (!originalImage.src) {
                showStatus('è¯·å…ˆä¸Šä¼ éœ€è¦è¿˜åŸçš„å›¾ç‰‡', 'error', statusOriginal);
                return;
            }
            
            const gridSize = validateGridSize();
            if (!gridSize) return;
            
            const { rows, cols } = gridSize;
            const totalBlocks = rows * cols;
            const seed = currentSeed;
            
            // å¯¹äºéå¸¸å¤§çš„ç½‘æ ¼ç»™å‡ºè­¦å‘Š
            if (totalBlocks > 10000) {
                if (!confirm(`æ‚¨è®¾ç½®çš„ç½‘æ ¼è¾ƒå¤§ï¼ˆ${totalBlocks}ä¸ªåŒºå—ï¼‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´æµè§ˆå™¨å¡é¡¿ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ`)) {
                    return;
                }
            }
            
            // åˆ›å»ºcanvaså…ƒç´ è¿›è¡Œå¤„ç†
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // è®¾ç½®canvaså°ºå¯¸ä¸åŸå›¾å®Œå…¨ä¸€è‡´
            canvas.width = originalImage.naturalWidth;
            canvas.height = originalImage.naturalHeight;
            
            // ç»˜åˆ¶åŸå›¾åˆ°canvas
            ctx.drawImage(originalImage, 0, 0);
            
            // è®¡ç®—æ¯ä¸ªåŒºå—çš„ç²¾ç¡®ä½ç½®å’Œå¤§å°
            const blocks = calculateBlockDimensions(canvas.width, canvas.height, rows, cols);
            
            // æå–æ¯ä¸ªåŒºå—çš„åƒç´ æ•°æ®
            const blockData = blocks.map(block => {
                return {
                    ...block,
                    pixels: ctx.getImageData(block.x, block.y, block.width, block.height)
                };
            });
            
            // ä½¿ç”¨ç›¸åŒç§å­ç”Ÿæˆç›¸åŒçš„æ‰“ä¹±é¡ºåºï¼Œç„¶åè®¡ç®—è¿˜åŸé¡ºåº
            const baseOrder = Array.from({ length: blocks.length }, (_, i) => i);
            const scrambleOrder = shuffleArrayWithSeed(baseOrder, `scramble_${seed}`);
            
            // è®¡ç®—è¿˜åŸé¡ºåº
            const restoreOrder = Array(blocks.length);
            for (let i = 0; i < scrambleOrder.length; i++) {
                restoreOrder[scrambleOrder[i]] = i;
            }
            
            // ä½¿ç”¨ç›¸åŒç§å­ç”Ÿæˆç›¸åŒçš„åè‰²åŒºå—æ˜ å°„
            const invertMap = Array(blocks.length).fill(false);
            const invertPercent = validateInvertPercentage();
            const invertCount = Math.floor(totalBlocks * (invertPercent / 100));
            
            if (enableInvert.checked && invertCount > 0) {
                const invertIndices = shuffleArrayWithSeed(baseOrder, `invert_${seed}`);
                for (let i = 0; i < invertCount; i++) {
                    invertMap[invertIndices[i]] = true;
                }
            }
            
            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // æŒ‰ç…§è¿˜åŸé¡ºåºç»˜åˆ¶åŒºå—ï¼Œå¹¶æ¢å¤åè‰²
            for (let i = 0; i < blocks.length; i++) {
                const originalIndex = restoreOrder[i];
                const targetBlock = blocks[i];
                let sourceData = blockData[originalIndex].pixels;
                
                // å¦‚æœè¯¥åŒºå—åœ¨æ··æ·†æ—¶è¢«åè‰²äº†ï¼Œç°åœ¨éœ€è¦å†æ¬¡åè‰²ä»¥æ¢å¤åŸå§‹è‰²å½©
                if (enableInvert.checked && invertMap[originalIndex]) {
                    // åˆ›å»ºæ•°æ®å‰¯æœ¬
                    const invertedData = new ImageData(
                        new Uint8ClampedArray(sourceData.data),
                        sourceData.width,
                        sourceData.height
                    );
                    sourceData = invertColors(invertedData);
                }
                
                // ç»˜åˆ¶åŒºå—åˆ°åŸå§‹ä½ç½®
                ctx.putImageData(sourceData, targetBlock.x, targetBlock.y);
            }
            
            // æ˜¾ç¤ºå¤„ç†åçš„å›¾ç‰‡
            processedImage.src = canvas.toDataURL('image/png');
            processedImage.onload = function() {
                processedPlaceholder.style.display = 'none';
                processedImage.style.display = 'block';
                saveBtn.disabled = false;
                showStatus(`å›¾ç‰‡å·²è¿˜åŸï¼Œä½¿ç”¨ç§å­: ${seed}`, 'success', statusProcessed);
            };
        }
        
        // ä¿å­˜å¤„ç†åçš„å›¾ç‰‡
        function saveProcessedImage() {
            if (!processedImage.src) {
                showStatus('æ²¡æœ‰å¯ä¿å­˜çš„å›¾ç‰‡', 'error', statusProcessed);
                return;
            }
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const link = document.createElement('a');
            link.download = 'processed-image.png';
            link.href = processedImage.src;
            
            // è§¦å‘ä¸‹è½½
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showStatus('å›¾ç‰‡å·²ä¿å­˜ï¼Œè¯·è®°ä½å½“å‰ç§å­å€¼ä»¥ä¾¿å°†æ¥è¿˜åŸ', 'success', statusProcessed);
        }
        
        // æ¸…é™¤æ‰€æœ‰å›¾ç‰‡
        function clearImages() {
            originalImage.src = '';
            originalImage.style.display = 'none';
            originalPlaceholder.style.display = 'flex';
            
            processedImage.src = '';
            processedImage.style.display = 'none';
            processedPlaceholder.style.display = 'flex';
            
            fileInput.value = '';
            saveBtn.disabled = true;
            
            statusOriginal.textContent = '';
            statusOriginal.className = 'status-message';
            statusProcessed.textContent = '';
            statusProcessed.className = 'status-message';
        }
        
        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, type, element) {
            element.textContent = message;
            element.className = 'status-message';
            element.classList.add(`status-${type}`);
            
            // 5ç§’åè‡ªåŠ¨æ¸…é™¤æ¶ˆæ¯ï¼ˆç§å­ç›¸å…³æ¶ˆæ¯ä¿ç•™æ—¶é—´æ›´é•¿ï¼‰
            const timeout = message.includes('ç§å­') ? 8000 : 3000;
            setTimeout(() => {
                element.textContent = '';
                element.className = 'status-message';
            }, timeout);
        }
        
        // åˆå§‹åŒ–åº”ç”¨
        window.onload = init;
        
        console.log("ä»£ç ç”±è±†åŒ…AIç”Ÿæˆã€‚ï¼ˆç°åœ¨AIçœŸå‰å®³â€¦â€¦ï¼‰")
    </script>
</body>
</html>
    